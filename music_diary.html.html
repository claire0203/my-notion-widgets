<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kitsch Music Diary</title>
<style>
  /* --- ë””ìì¸ í…Œë§ˆ --- */
  :root {
    --bg-color: transparent;
    --card-bg: #D7E8F7; /* íŒŒìŠ¤í…” ë¸”ë£¨ */
    --paper-bg: #ffffff;
    --text-color: #455A64;
    --accent-color: #90CAF9;
    --accent-dark: #64B5F6;
    --shadow: 0 10px 30px rgba(69, 90, 100, 0.15);
    /* í°íŠ¸: ì „ì²´ Sans-Serif í†µì¼ */
    --font-stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  body {
    background-color: var(--bg-color);
    display: flex;
    justify-content: center;
    align-items: flex-start; 
    min-height: 100vh;
    margin: 0;
    padding: 20px 0;
    font-family: var(--font-stack);
    color: var(--text-color);
    box-sizing: border-box;
  }

  /* ë©”ì¸ ì¹´ë“œ (ëª¨ëˆˆì¢…ì´ ë‹¤ì´ì–´ë¦¬ ëŠë‚Œ) */
  .diary-card {
    background-color: var(--card-bg);
    /* í‚¤ì¹˜í•œ ëª¨ëˆˆ íŒ¨í„´ ë°°ê²½ ì¶”ê°€ */
    background-image: 
      linear-gradient(rgba(255, 255, 255, 0.3) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.3) 1px, transparent 1px);
    background-size: 20px 20px;
    
    width: 400px;
    padding: 30px;
    border-radius: 24px;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    position: relative;
    /* ë†’ì´ ì œí•œ ì—†ìŒ (í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ì¡°ì ˆ) */
    min-height: 600px; 
  }

  /* ì™¼ìª½ ë°”ì¸ë” ë§ */
  .binder-rings {
    position: absolute;
    left: 12px;
    top: 40px;
    bottom: 40px;
    width: 15px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    z-index: 2;
    pointer-events: none;
  }
  .ring {
    width: 14px;
    height: 14px;
    background: #fff;
    border-radius: 50%;
    border: 2px solid #BDD7EE; /* ë§ í…Œë‘ë¦¬ */
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
  }

  .loading-indicator {
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 12px;
    color: var(--text-color);
    opacity: 0;
    font-weight: 800;
  }
  .loading-indicator.show { opacity: 0.8; }

  .card-title {
    font-size: 22px;
    font-weight: 900; /* ì•„ì£¼ ë‘ê»ê²Œ */
    letter-spacing: 0.05em;
    text-transform: uppercase;
    margin: 0 0 25px 0;
    text-align: center;
    padding-left: 20px;
    color: #fff;
    text-shadow: 2px 2px 0px rgba(0,0,0,0.1); /* í‚¤ì¹˜í•œ ê·¸ë¦¼ì */
  }

  /* --- ì…ë ¥ ì˜ì—­ --- */
  .input-area {
    background: rgba(255,255,255,0.7);
    backdrop-filter: blur(5px);
    padding: 15px;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 25px;
    margin-left: 20px; /* ë§ ê³µê°„ */
    border: 2px solid #fff;
  }

  .date-picker {
    padding: 10px;
    border: 2px solid #eee;
    border-radius: 10px;
    font-family: var(--font-stack);
    color: var(--text-color);
    outline: none;
    font-weight: 600;
  }

  .diary-input {
    padding: 12px;
    border: 2px solid #eee;
    border-radius: 10px;
    background: #fff;
    font-family: var(--font-stack);
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
  }
  .diary-input:focus { border-color: var(--accent-color); }
  
  .embed-input {
    font-family: monospace;
    font-size: 11px;
    color: #888;
  }

  #addBtn {
    background: var(--accent-color);
    color: white;
    border: none;
    padding: 12px;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 800;
    transition: transform 0.1s;
  }
  #addBtn:hover { background: var(--accent-dark); transform: scale(1.02); }


  /* --- ë‹¤ì´ì–´ë¦¬ ë¦¬ìŠ¤íŠ¸ --- */
  #diaryList {
    list-style: none;
    padding: 0;
    margin: 0;
    margin-left: 20px;
    flex-grow: 1;
  }

  /* ê°œë³„ ì¼ê¸°ì¥ (í´ë¼ë¡œì´ë“œ/ë©”ëª¨ì§€ ëŠë‚Œ) */
  .diary-entry {
    background: var(--paper-bg);
    padding: 20px;
    border-radius: 4px; /* ê°ì§„ ì¢…ì´ ëŠë‚Œ */
    margin-bottom: 25px;
    box-shadow: 2px 4px 10px rgba(0,0,0,0.05);
    position: relative;
    animation: slideIn 0.3s ease-out;
    border: 1px solid #eee;
  }

  /* ë§ˆìŠ¤í‚¹ í…Œì´í”„ íš¨ê³¼ (CSSë¡œ êµ¬í˜„) */
  .diary-entry::before {
    content: '';
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%) rotate(-2deg);
    width: 80px;
    height: 25px;
    background-color: rgba(255, 255, 255, 0.6);
    border-left: 2px dashed rgba(0,0,0,0.1);
    border-right: 2px dashed rgba(0,0,0,0.1);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    z-index: 1;
  }

  .entry-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 2px dashed #E0F2F1; /* ê·€ì—¬ìš´ ì ì„  */
  }

  .entry-date-group {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .date-sticker {
    background: #FFECB3;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
    color: #FF6F00;
    transform: rotate(-3deg);
  }

  .entry-date {
    font-weight: 700;
    font-size: 15px;
    color: #546E7A;
  }

  .delete-btn {
    cursor: pointer;
    font-size: 18px;
    color: #CFD8DC;
    transition: color 0.2s;
  }
  .delete-btn:hover { color: #ff8a80; }

  .entry-note {
    font-size: 15px;
    line-height: 1.5;
    color: #455A64;
    margin-bottom: 15px;
    white-space: pre-wrap;
    background: #FAFAFA;
    padding: 10px;
    border-radius: 8px;
  }

  .entry-player {
    width: 100%;
    border-radius: 12px;
    overflow: hidden;
    background: #f0f0f0;
    border: 4px solid #fff; /* ì‚¬ì§„ í…Œë‘ë¦¬ ëŠë‚Œ */
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  
  .entry-player iframe {
    width: 100% !important;
    border: none !important;
    display: block !important;
  }

  /* --- í˜ì´ì§€ë„¤ì´ì…˜ ì»¨íŠ¸ë¡¤ (New!) --- */
  .pagination-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    margin-top: 20px;
    padding-left: 20px;
  }

  .page-btn {
    background: #fff;
    border: 2px solid #D7E8F7;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    color: var(--accent-color);
    font-weight: bold;
    font-size: 18px;
    transition: all 0.2s;
  }
  .page-btn:hover { background: var(--accent-color); color: #fff; }
  .page-btn:disabled { background: #eee; border-color: #eee; color: #ccc; cursor: not-allowed; }

  .page-info {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-color);
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

</style>
</head>
<body>

<div class="diary-card">
  <div class="loading-indicator" id="loadingIndicator">Checking...</div>
  
  <div class="binder-rings">
    <div class="ring"></div><div class="ring"></div><div class="ring"></div><div class="ring"></div>
  </div>

  <h2 class="card-title">MY MUSIC DIARY</h2>

  <div class="input-area">
    <input type="date" id="dateInput" class="date-picker">
    <input type="text" id="noteInput" class="diary-input" placeholder="ì˜¤ëŠ˜ì˜ ê°ìƒí‰ (Comment)">
    <input type="text" id="embedInput" class="diary-input embed-input" placeholder='ì• í”Œë®¤ì§ Embed Code ë¶™ì—¬ë„£ê¸°'>
    <button id="addBtn">ê¸°ë¡í•˜ê¸° (Save)</button>
  </div>

  <ul id="diaryList"></ul>

  <div class="pagination-controls">
    <button id="prevBtn" class="page-btn">&lt;</button>
    <span id="pageInfo" class="page-info">1 / 1</span>
    <button id="nextBtn" class="page-btn">&gt;</button>
  </div>
</div>

<script>
  // =======================================================
  // [í•„ìˆ˜] ë®¤ì§ ë‹¤ì´ì–´ë¦¬ìš© BIN IDë¥¼ ë„£ìœ¼ì„¸ìš”! (ëŒ€ê´„í˜¸ [])
  const DIARY_BIN_ID = "693ed52743b1c97be9edc4dd"; 
  const API_KEY = "$2a$10$7/urvzV65WS3eRC9dhD4Pe5dDs/W2TYnytNLMFjLA3Tst3JXORJwO";
  // =======================================================

  const API_URL = `https://api.jsonbin.io/v3/b/${DIARY_BIN_ID}`;
  let diaryData = [];
  
  // í˜ì´ì§€ë„¤ì´ì…˜ ì„¤ì • (í•œ í˜ì´ì§€ì— 3ê°œì”©)
  let currentPage = 1;
  const itemsPerPage = 3;

  // DOM
  const loadingIndicator = document.getElementById('loadingIndicator');
  const dateInput = document.getElementById('dateInput');
  const noteInput = document.getElementById('noteInput');
  const embedInput = document.getElementById('embedInput');
  const diaryList = document.getElementById('diaryList');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const pageInfo = document.getElementById('pageInfo');

  function init() {
    dateInput.valueAsDate = new Date();
    loadData();
    document.getElementById('addBtn').addEventListener('click', addEntry);
    prevBtn.addEventListener('click', () => changePage(-1));
    nextBtn.addEventListener('click', () => changePage(1));
  }

  function showLoading(show, txt="Loading...") {
    loadingIndicator.textContent = txt;
    loadingIndicator.classList.toggle('show', show);
  }

  // --- Read ---
  function loadData() {
    showLoading(true);
    fetch(API_URL, {
      method: 'GET',
      headers: { 'X-Master-Key': API_KEY }
    })
    .then(r => r.json())
    .then(data => {
      diaryData = Array.isArray(data.record) ? data.record : [];
      currentPage = 1; // ë¡œë“œ ì‹œ 1í˜ì´ì§€ë¡œ ì´ˆê¸°í™”
      renderDiary();
      showLoading(false);
    })
    .catch(e => { console.error(e); showLoading(true, "Error!"); });
  }

  // --- Save ---
  function saveData() {
    showLoading(true, "Saving...");
    fetch(API_URL, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY },
      body: JSON.stringify(diaryData),
    })
    .then(r => r.json())
    .then(() => {
      renderDiary(); // ì €ì¥ í›„ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
      showLoading(false);
      noteInput.value = '';
      embedInput.value = '';
    })
    .catch(e => { console.error(e); showLoading(true, "Save Error!"); });
  }

  // --- Add ---
  function addEntry() {
    const date = dateInput.value;
    const note = noteInput.value.trim();
    const embedCode = embedInput.value.trim();

    if (!embedCode.startsWith('<iframe')) {
      alert("ì˜¬ë°”ë¥¸ ì• í”Œë®¤ì§ 'ì„ë² ë“œ ì½”ë“œ'ë¥¼ ë„£ì–´ì£¼ì„¸ìš”!");
      return;
    }

    const newEntry = {
      id: Date.now(),
      date: date,
      note: note,
      embed: embedCode
    };

    diaryData.unshift(newEntry); // ë§¨ ì•ì— ì¶”ê°€
    currentPage = 1; // ìƒˆ ê¸€ ì“°ë©´ 1í˜ì´ì§€ë¡œ ì´ë™
    saveData();
  }

  // --- Delete ---
  window.deleteEntry = function(id) {
    // ë¬¸êµ¬ ìˆ˜ì •ë¨: ì •ì¤‘í•˜ê³  ëª…í™•í•˜ê²Œ
    if (!confirm("ì´ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) return;
    diaryData = diaryData.filter(e => e.id !== id);
    saveData();
  }

  // --- Render (Pagination Applied) ---
  function renderDiary() {
    diaryList.innerHTML = '';
    
    if (diaryData.length === 0) {
      diaryList.innerHTML = '<li style="text-align:center; color:#888; padding:30px;">ê¸°ë¡ëœ ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤. ğŸµ</li>';
      pageInfo.textContent = "0 / 0";
      prevBtn.disabled = true;
      nextBtn.disabled = true;
      return;
    }

    // í˜ì´ì§€ë„¤ì´ì…˜ ê³„ì‚°
    const totalPages = Math.ceil(diaryData.length / itemsPerPage);
    if (currentPage > totalPages) currentPage = totalPages;
    if (currentPage < 1) currentPage = 1;

    const start = (currentPage - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const pageData = diaryData.slice(start, end);

    // ëœë¤ ìŠ¤í‹°ì»¤ (ì¬ë¯¸ ìš”ì†Œ)
    const stickers = ['ğŸ§', 'ğŸ’¿', 'ğŸ¹', 'ğŸ¸', 'ğŸ¤', 'ğŸ¼', 'â˜ï¸', 'ğŸ’™'];

    pageData.forEach((entry, index) => {
      const li = document.createElement('li');
      li.className = 'diary-entry';
      
      const dateObj = new Date(entry.date);
      const dateStr = `${dateObj.getFullYear()}.${String(dateObj.getMonth()+1).padStart(2,'0')}.${String(dateObj.getDate()).padStart(2,'0')}`;
      // ì¼ê¸°ë§ˆë‹¤ ê³ ìœ í•œ ëŠë‚Œì„ ì£¼ê¸° ìœ„í•´ ë‚ ì§œ(ì¼)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìŠ¤í‹°ì»¤ ì„ íƒ
      const sticker = stickers[dateObj.getDate() % stickers.length];

      li.innerHTML = `
        <div class="entry-header">
          <div class="entry-date-group">
            <span class="date-sticker">${sticker}</span>
            <span class="entry-date">${dateStr}</span>
          </div>
          <span class="delete-btn" onclick="deleteEntry(${entry.id})">&times;</span>
        </div>
        ${entry.note ? `<div class="entry-note">${entry.note}</div>` : ''}
        <div class="entry-player">
          ${entry.embed} 
        </div>
      `;
      diaryList.appendChild(li);
    });

    // í˜ì´ì§€ ì»¨íŠ¸ë¡¤ ì—…ë°ì´íŠ¸
    pageInfo.textContent = `${currentPage} / ${totalPages}`;
    prevBtn.disabled = currentPage === 1;
    nextBtn.disabled = currentPage === totalPages;
  }

  function changePage(step) {
    currentPage += step;
    renderDiary();
  }

  init();
</script>
</body>
</html>