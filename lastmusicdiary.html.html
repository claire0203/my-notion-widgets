<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MUSIC DIARY</title>
<style>
  /* --- Kitsch & Pastel Theme --- */
  :root {
    --bg-color: #E3F2FD; /* ë§‘ì€ íŒŒìŠ¤í…” ë¸”ë£¨ */
    --card-bg: #FFFFFF;
    --accent-color: #64B5F6; /* í¬ì¸íŠ¸ ë¸”ë£¨ */
    --text-title: #424242; /* ì œëª©/ë‚ ì§œìš© */
    --text-body: #5D4037; /* ê°ìƒí‰ìš© (ë”°ëœ»í•œ ìƒ‰) */
    
    /* Font 1: ê¹”ë”í•œ ê³ ë”• (ì œëª©, ë‚ ì§œ) */
    --font-sans: -apple-system, BlinkMacSystemFont, "Pretendard", "Malgun Gothic", sans-serif;
    /* Font 2: ê°ì„±ì ì¸ ëª…ì¡° (ê°ìƒí‰) */
    --font-serif: "Batang", "KoPub Batang", "Times New Roman", serif;
  }

  body {
    background-color: var(--bg-color);
    background-image: radial-gradient(#BBDEFB 1px, transparent 1px); /* ì•„ì£¼ ì€ì€í•œ ë„íŠ¸ */
    background-size: 20px 20px;
    display: flex;
    justify-content: center;
    align-items: flex-start; 
    min-height: 100vh;
    margin: 0;
    padding: 30px 10px;
    font-family: var(--font-sans);
    color: var(--text-title);
  }

  /* ë©”ì¸ ë‹¤ì´ì–´ë¦¬ ì¹´ë“œ */
  .diary-card {
    background-color: var(--card-bg);
    width: 100%;
    max-width: 450px;
    padding: 30px;
    border-radius: 20px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
    box-shadow: 0 10px 25px rgba(100, 181, 246, 0.2); /* íŒŒìŠ¤í…” ê·¸ë¦¼ì */
    display: flex;
    flex-direction: column;
    position: relative;
    min-height: 600px;
    border: 4px solid #fff; /* í°ìƒ‰ í…Œë‘ë¦¬ */
    outline: 2px dashed #BBDEFB; /* ìŠ¤í‹°ì¹˜ íš¨ê³¼ */
  }

  /* ì™¼ìª½ ë°”ì¸ë” ë§ Decoration */
  .binder-rings {
    position: absolute;
    left: 10px;
    top: 50px;
    bottom: 50px;
    width: 20px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    z-index: 2;
    pointer-events: none;
  }
  .ring {
    width: 12px;
    height: 12px;
    background: #fff;
    border-radius: 50%;
    border: 3px solid #90CAF9;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
  }

  /* ì œëª© */
  h1 {
    font-family: var(--font-sans);
    font-size: 24px;
    font-weight: 800;
    text-align: center;
    margin: 0 0 25px 0;
    letter-spacing: 1px;
    color: var(--accent-color);
    text-transform: uppercase;
    text-shadow: 1px 1px 0 #E1F5FE;
  }

  /* ì…ë ¥ ì˜ì—­ (í¬ìŠ¤íŠ¸ì‡ ëŠë‚Œ) */
  .input-area {
    background: #F0F8FF; /* ì•„ì£¼ ì—°í•œ ë¸”ë£¨ */
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 25px;
    margin-left: 15px; /* ë§ ê³µê°„ í™•ë³´ */
    border: 1px solid #E1F5FE;
    display: flex;
    flex-direction: column;
    gap: 10px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.03);
  }

  .row { display: flex; gap: 8px; }

  input, textarea {
    border: 1px solid #CFD8DC;
    border-radius: 8px;
    padding: 10px;
    font-family: var(--font-sans);
    font-size: 13px;
    background: #fff;
    outline: none;
  }
  input:focus { border-color: var(--accent-color); }

  /* ë²„íŠ¼ */
  .btn-group { display: flex; gap: 8px; margin-top: 5px; }
  
  button {
    padding: 10px;
    border-radius: 8px;
    border: none;
    font-weight: 700;
    cursor: pointer;
    font-size: 13px;
    font-family: var(--font-sans);
    transition: 0.1s;
  }
  
  #saveBtn { background: var(--accent-color); color: #fff; flex: 2; } 
  #saveBtn:hover { background: #42A5F5; }
  #cancelBtn { background: #ECEFF1; color: #90A4AE; flex: 1; display: none; }

  /* ë¦¬ìŠ¤íŠ¸ ì˜ì—­ (ì•„ì½”ë””ì–¸) */
  #diaryList {
    margin-left: 15px;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  /* ê°œë³„ ì•„ì´í…œ */
  .diary-item {
    border-bottom: 1px dashed #E0E0E0;
    padding-bottom: 10px;
  }

  /* í—¤ë” (í´ë¦­í•´ì„œ í¼ì¹˜ê¸°) */
  .d-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    padding: 8px 10px;
    background: #fff;
    border-radius: 8px;
    transition: background 0.2s;
  }
  .d-header:hover { background: #F5F5F5; }

  .d-date-group { display: flex; align-items: center; gap: 8px; }
  
  /* ë‚ ì§œ ìŠ¤í‹°ì»¤ */
  .date-badge {
    background: #BBDEFB;
    color: #1565C0;
    font-size: 11px;
    font-weight: 800;
    padding: 3px 6px;
    border-radius: 4px;
    font-family: var(--font-sans);
  }
  
  .d-time { font-size: 12px; color: #90A4AE; font-weight: 600; }
  .d-icon { font-size: 18px; }

  /* ë‚´ìš© (ìˆ¨ê¹€/í¼ì¹¨) */
  .d-content {
    display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
    padding: 10px;
    margin-top: 5px;
    background: #FAFAFA;
    border-radius: 8px;
    animation: slideDown 0.3s ease;
  }

  .diary-item.active .d-content { display: block; }
  .diary-item.active .d-header { background: #E3F2FD; border-radius: 8px 8px 0 0; }

  /* ê°ìƒí‰ (Serif í°íŠ¸ ì ìš©!) */
  .d-note {
    font-family: var(--font-serif);
    font-size: 15px;
    line-height: 1.6;
    color: var(--text-body);
    white-space: pre-wrap;
    margin-bottom: 15px;
    padding: 10px;
    background: #fff;
    border-left: 3px solid var(--accent-color); /* ì¸ìš©êµ¬ ëŠë‚Œ */
  }

  .d-player iframe { width: 100% !important; border: none; border-radius: 8px; display: block; }

  /* ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ */
  .d-actions {
    display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px;
  }
  .act-btn {
    font-size: 11px; font-weight: bold; cursor: pointer;
    background: none; border: none; padding: 4px 8px;
  }
  .act-edit { color: #64B5F6; background: #E3F2FD; border-radius: 4px; }
  .act-del { color: #E57373; background: #FFEBEE; border-radius: 4px; }

  /* ë¡œë”© */
  #loading {
    text-align: center; color: #B0BEC5; font-size: 12px;
    position: absolute; top: 15px; right: 20px; opacity: 0;
  }
  #loading.show { opacity: 1; }

  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<div class="diary-card">
  <div id="loading">Loading...</div>

  <div class="binder-rings">
    <div class="ring"></div><div class="ring"></div><div class="ring"></div><div class="ring"></div>
  </div>

  <h1>ğŸ§ MUSIC DIARY</h1>

  <div class="input-area">
    <div class="row">
      <input type="date" id="dateInput" style="flex:2">
      <input type="time" id="timeInput" style="flex:1">
    </div>
    <input type="text" id="noteInput" placeholder="ì˜¤ëŠ˜ì˜ ê°ìƒí‰ì„ ì ì–´ë³´ì„¸ìš”...">
    <input type="text" id="embedInput" style="font-family:monospace; color:#888; font-size:11px;" placeholder='ì• í”Œë®¤ì§ ì„ë² ë“œ ì½”ë“œ (<iframe...)'>
    
    <div class="btn-group">
      <button id="cancelBtn">ì·¨ì†Œ</button>
      <button id="saveBtn">ê¸°ë¡í•˜ê¸°</button>
    </div>
  </div>

  <div id="diaryList"></div>

</div>

<script>
  // ğŸ”’ ì„¤ì •: ë³¸ì¸ì˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”
  const BIN_ID = "693f04aad0ea881f40292b6e"; 
  const API_KEY = "$2a$10$7/urvzV65WS3eRC9dhD4Pe5dDs/W2TYnytNLMFjLA3Tst3JXORJwO";
  // =====================================

  const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
  
  let musicData = [];
  let isEditing = false;
  let editId = null;

  // DOM Elements
  const loading = document.getElementById('loading');
  const dateInput = document.getElementById('dateInput');
  const timeInput = document.getElementById('timeInput');
  const noteInput = document.getElementById('noteInput');
  const embedInput = document.getElementById('embedInput');
  const saveBtn = document.getElementById('saveBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const diaryList = document.getElementById('diaryList');

  function init() {
    // í˜„ì¬ ì‹œê°„ ìë™ ì„¸íŒ…
    const now = new Date();
    dateInput.valueAsDate = now;
    timeInput.value = now.toTimeString().substring(0, 5);

    loadData();

    saveBtn.addEventListener('click', handleSave);
    cancelBtn.addEventListener('click', resetForm);
  }

  function showMsg(txt, show=true) {
    loading.textContent = txt;
    loading.classList.toggle('show', show);
  }

  async function loadData() {
    showMsg("Loading...");
    try {
      const res = await fetch(API_URL + '/latest', {
        headers: { 'X-Master-Key': API_KEY }
      });
      const data = await res.json();
      musicData = Array.isArray(data.record) ? data.record : [];
      renderList();
      showMsg("", false);
    } catch (e) {
      console.error(e);
      showMsg("Error!");
    }
  }

  async function handleSave() {
    const date = dateInput.value;
    const time = timeInput.value;
    const note = noteInput.value.trim();
    const embedCode = embedInput.value.trim();

    if (!embedCode.startsWith('<iframe')) {
      alert("âš ï¸ ì• í”Œë®¤ì§ 'ì„ë² ë“œ ì½”ë“œ'ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”!");
      return;
    }

    showMsg("Saving...");

    if (isEditing) {
      const idx = musicData.findIndex(item => item.id === editId);
      if (idx !== -1) {
        musicData[idx] = { ...musicData[idx], date, time, note, embed: embedCode };
      }
    } else {
      const newItem = {
        id: Date.now(),
        date, time, note, embed: embedCode
      };
      musicData.unshift(newItem);
    }

    await updateServer();
    resetForm();
  }

  window.deleteEntry = async function(id) {
    if(!confirm("ì´ ê¸°ë¡ì„ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    musicData = musicData.filter(item => item.id !== id);
    showMsg("Deleting...");
    await updateServer();
  }

  async function updateServer() {
    try {
      await fetch(API_URL, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY },
        body: JSON.stringify({ record: musicData }),
      });
      renderList();
      showMsg("Done!", true);
      setTimeout(() => showMsg("", false), 1500);
    } catch (e) {
      console.error(e);
      showMsg("Save Failed");
    }
  }

  window.startEdit = function(id) {
    const item = musicData.find(i => i.id === id);
    if(!item) return;

    dateInput.value = item.date;
    timeInput.value = item.time || "00:00";
    noteInput.value = item.note;
    embedInput.value = item.embed;

    isEditing = true;
    editId = id;

    saveBtn.textContent = "ìˆ˜ì •ì™„ë£Œ";
    cancelBtn.style.display = "block";
    
    // ì…ë ¥ì°½ìœ¼ë¡œ ìŠ¤í¬ë¡¤
    document.querySelector('.input-area').scrollIntoView({ behavior: 'smooth' });
  }

  function resetForm() {
    const now = new Date();
    dateInput.valueAsDate = now;
    timeInput.value = now.toTimeString().substring(0, 5);
    noteInput.value = '';
    embedInput.value = '';
    
    isEditing = false;
    editId = null;
    
    saveBtn.textContent = "ê¸°ë¡í•˜ê¸°";
    cancelBtn.style.display = "none";
  }

  // ì•„ì½”ë””ì–¸ í† ê¸€ í•¨ìˆ˜
  window.toggleItem = function(header) {
    const item = header.parentElement;
    item.classList.toggle('active');
  }

  function renderList() {
    diaryList.innerHTML = '';
    
    if (musicData.length === 0) {
      diaryList.innerHTML = '<div style="text-align:center; color:#ccc; padding:20px;">No records yet.</div>';
      return;
    }

    const icons = ['ğŸ§', 'ğŸ’¿', 'ğŸ¹', 'ğŸ¸', 'ğŸ¼', 'â˜ï¸'];

    musicData.forEach((item, idx) => {
      const dateObj = new Date(item.date);
      // í¬ë§·: 25.12.15
      const dateStr = `${String(dateObj.getFullYear()).slice(2)}.${String(dateObj.getMonth()+1).padStart(2,'0')}.${String(dateObj.getDate()).padStart(2,'0')}`;
      const timeStr = item.time || ""; 
      const icon = icons[idx % icons.length];

      const div = document.createElement('div');
      div.className = 'diary-item';
      div.innerHTML = `
        <div class="d-header" onclick="toggleItem(this)">
          <div class="d-date-group">
            <span class="d-icon">${icon}</span>
            <span class="date-badge">${dateStr}</span>
            <span class="d-time">${timeStr}</span>
          </div>
          <div style="font-size:12px; color:#ccc;">â–¼</div>
        </div>

        <div class="d-content">
          ${item.note ? `<div class="d-note">${item.note}</div>` : ''}
          <div class="d-player">
            ${item.embed}
          </div>
          <div class="d-actions">
            <button class="act-btn act-edit" onclick="startEdit(${item.id})">EDIT</button>
            <button class="act-btn act-del" onclick="deleteEntry(${item.id})">DEL</button>
          </div>
        </div>
      `;
      diaryList.appendChild(div);
    });
  }

  init();
</script>
</body>
</html>