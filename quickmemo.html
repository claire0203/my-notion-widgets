<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pastel Quick Memo</title>
<style>
  /* --- Kitsch & Pastel Theme --- */
  :root {
    --bg-color: transparent;
    --main-color: #D7E8F7; /* íŒŒìŠ¤í…” ë¸”ë£¨ */
    --accent-color: #90CAF9; /* ì§„í•œ íŒŒìŠ¤í…” ë¸”ë£¨ */
    --text-color: #546E7A;
    --paper-bg: #ffffff;
    --pin-color: #FFB74D; /* ê³ ì •í•€ ìƒ‰ìƒ (íŒŒìŠ¤í…” ì˜¤ë Œì§€) */
    --shadow: 0 4px 15px rgba(144, 202, 249, 0.25);
    --font-stack: -apple-system, BlinkMacSystemFont, "Pretendard", sans-serif;
  }

  body {
    background-color: var(--bg-color);
    margin: 0; padding: 10px;
    font-family: var(--font-stack);
    display: flex; justify-content: center;
    box-sizing: border-box;
    overflow: hidden; /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ (ê¹”ë”í•˜ê²Œ) */
  }

  /* ì „ì²´ ì»¨í…Œì´ë„ˆ */
  .memo-widget {
    width: 100%; max-width: 320px;
    position: relative;
    transition: all 0.3s ease;
  }

  /* 1. í† ê¸€ ë²„íŠ¼ (ì ‘í˜€ìˆì„ ë•Œ ë³´ì´ëŠ” ë¶€ë¶„) */
  .toggle-bar {
    background: var(--main-color);
    padding: 12px 20px;
    border-radius: 25px;
    color: #fff;
    font-weight: 800;
    font-size: 15px;
    cursor: pointer;
    box-shadow: var(--shadow);
    display: flex; justify-content: space-between; align-items: center;
    border: 3px solid #fff;
    transition: transform 0.2s;
    user-select: none;
  }
  .toggle-bar:hover { transform: scale(1.02); background: var(--accent-color); }
  .toggle-icon { font-size: 18px; }

  /* 2. ë©”ëª¨ì¥ ë³¸ì²´ (í¼ì³ì§€ëŠ” ë¶€ë¶„) */
  .memo-body {
    background: var(--paper-bg);
    border-radius: 20px;
    margin-top: 10px;
    padding: 20px;
    box-shadow: var(--shadow);
    border: 2px solid var(--main-color);
    display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
    flex-direction: column;
    animation: slideDown 0.3s ease-out;
    max-height: 400px; /* ë„ˆë¬´ ê¸¸ì–´ì§€ì§€ ì•Šê²Œ */
  }
  
  /* í™œì„±í™” ì‹œ ë³´ì„ */
  .memo-widget.active .memo-body { display: flex; }
  .memo-widget.active .toggle-bar { background: var(--accent-color); }
  .memo-widget.active .toggle-icon { transform: rotate(180deg); }

  /* ì…ë ¥ì°½ */
  .input-group {
    display: flex; gap: 8px; margin-bottom: 15px;
  }
  input {
    flex: 1; padding: 10px; border: 2px solid #E1F5FE; border-radius: 12px;
    outline: none; font-family: var(--font-stack); font-size: 13px; color: var(--text-color);
    background: #FAFAFA;
  }
  input:focus { border-color: var(--accent-color); background: #fff; }
  
  button#addBtn {
    background: var(--accent-color); color: white; border: none;
    width: 36px; height: 36px; border-radius: 12px; cursor: pointer;
    font-size: 18px; display: flex; align-items: center; justify-content: center;
  }

  /* ë©”ëª¨ ë¦¬ìŠ¤íŠ¸ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) */
  .memo-list {
    list-style: none; padding: 0; margin: 0;
    overflow-y: auto;
    flex-grow: 1;
    /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
    scrollbar-width: thin;
    scrollbar-color: #CFD8DC transparent;
  }
  .memo-list::-webkit-scrollbar { width: 4px; }
  .memo-list::-webkit-scrollbar-thumb { background-color: #CFD8DC; border-radius: 4px; }

  /* ê°œë³„ ë©”ëª¨ ì•„ì´í…œ */
  .memo-item {
    padding: 10px;
    border-bottom: 1px dashed #ECEFF1;
    display: flex; flex-direction: column; gap: 4px;
    position: relative;
    transition: background 0.2s;
  }
  .memo-item:last-child { border-bottom: none; }
  .memo-item:hover { background: #FAFAFA; border-radius: 8px; }

  /* ê³ ì •ëœ ë©”ëª¨ ìŠ¤íƒ€ì¼ */
  .memo-item.pinned {
    background: #FFF8E1; /* ì—°í•œ ë…¸ë‘ ë°°ê²½ */
    border-radius: 8px;
    border: 1px solid #FFE082;
    margin-bottom: 5px;
  }

  .meta-row {
    display: flex; justify-content: space-between; align-items: center;
    font-size: 10px; color: #B0BEC5; font-weight: 600;
  }

  .content-row {
    font-size: 13px; color: var(--text-color); line-height: 1.4;
    word-break: break-all;
  }

  /* ì•¡ì…˜ ë²„íŠ¼ë“¤ (í•€, ì‚­ì œ) */
  .actions {
    display: flex; gap: 5px; opacity: 0.5; transition: opacity 0.2s;
  }
  .memo-item:hover .actions { opacity: 1; }
  
  .icon-btn {
    cursor: pointer; border: none; background: none; padding: 2px;
    font-size: 14px; transition: transform 0.1s;
  }
  .icon-btn:hover { transform: scale(1.2); }
  
  .btn-pin { color: #CFD8DC; }
  .memo-item.pinned .btn-pin { color: var(--pin-color); } /* ê³ ì •ë˜ë©´ ìƒ‰ìƒ ë³€ê²½ */
  
  .btn-del { color: #EF9A9A; }

  #loading {
    font-size: 11px; text-align: center; color: #ccc; margin-top: 5px; height: 15px;
  }

  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<div class="memo-widget" id="widget">
  <div class="toggle-bar" onclick="toggleWidget()">
    <span>â˜ï¸ Quick Memo</span>
    <span class="toggle-icon">â–¼</span>
  </div>

  <div class="memo-body">
    <div class="input-group">
      <input type="text" id="memoInput" placeholder="ì§€ê¸ˆ ë¬´ìŠ¨ ìƒê° ì¤‘ì¸ê°€ìš”?" onkeypress="handleEnter(event)">
      <button id="addBtn" onclick="addMemo()">+</button>
    </div>
    
    <div id="loading"></div>
    <ul class="memo-list" id="memoList">
      </ul>
  </div>
</div>

<script>
  // ===========================================
  // ğŸ”’ ì„¤ì •: ìƒˆë¡œ ë§Œë“  Bin IDë¥¼ ë„£ì–´ì£¼ì„¸ìš”!
  const MEMO_BIN_ID = "69417e4243b1c97be9f289a2"; 
  const API_KEY = "$2a$10$7/urvzV65WS3eRC9dhD4Pe5dDs/W2TYnytNLMFjLA3Tst3JXORJwO";
  // ===========================================

  const API_URL = `https://api.jsonbin.io/v3/b/${MEMO_BIN_ID}`;
  let memoData = [];
  const widget = document.getElementById('widget');
  const loading = document.getElementById('loading');

  // ìœ„ì ¯ í´ê¸°/ì ‘ê¸° í† ê¸€
  function toggleWidget() {
    widget.classList.toggle('active');
    // í¼ì¹  ë•Œ ë°ì´í„° ë¡œë“œ (ì²˜ìŒ í•œ ë²ˆë§Œ í•˜ê±°ë‚˜ ë§¤ë²ˆ í•˜ê±°ë‚˜ ì„ íƒ ê°€ëŠ¥)
    if(widget.classList.contains('active') && memoData.length === 0) {
      loadMemos();
    }
  }

  function showMsg(txt) { loading.textContent = txt; }

  // 1. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
  async function loadMemos() {
    showMsg("Loading...");
    try {
      const res = await fetch(API_URL + '/latest', {
        headers: { 'X-Master-Key': API_KEY }
      });
      const data = await res.json();
      
      // ë°ì´í„° êµ¬ì¡° ì²´í¬
      if (data.record && data.record.memos) {
        memoData = data.record.memos;
      } else if (Array.isArray(data.record)) {
        memoData = data.record;
      } else {
        memoData = [];
      }
      
      renderList();
      showMsg("");
    } catch (e) {
      console.error(e);
      showMsg("Error loading.");
    }
  }

  // 2. ì„œë²„ ì €ì¥í•˜ê¸° (ê³µí†µ í•¨ìˆ˜)
  async function saveToServer() {
    showMsg("Saving...");
    try {
      await fetch(API_URL, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY },
        body: JSON.stringify({ memos: memoData }), // { memos: [...] } êµ¬ì¡° ìœ ì§€
      });
      showMsg("Saved!");
      setTimeout(() => showMsg(""), 1000);
    } catch (e) {
      console.error(e);
      showMsg("Save failed.");
    }
  }

  // 3. ë©”ëª¨ ì¶”ê°€
  async function addMemo() {
    const input = document.getElementById('memoInput');
    const text = input.value.trim();
    if (!text) return;

    const now = new Date();
    const dateStr = `${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')}`;
    const timeStr = now.toTimeString().substring(0, 5); // HH:mm

    const newMemo = {
      id: Date.now(),
      text: text,
      date: dateStr,
      time: timeStr,
      isPinned: false // ê¸°ë³¸ì€ ê³ ì • ì•ˆ í•¨
    };

    memoData.unshift(newMemo); // ë§¨ ìœ„ì— ì¶”ê°€
    input.value = '';
    
    renderList();
    await saveToServer();
  }

  // 4. ê³ ì •(Pin) í† ê¸€
  async function togglePin(id) {
    const index = memoData.findIndex(m => m.id === id);
    if (index === -1) return;

    // ìƒíƒœ ë°˜ì „
    memoData[index].isPinned = !memoData[index].isPinned;
    
    renderList(); // í™”ë©´ ì¦‰ì‹œ ë°˜ì˜ (ì •ë ¬ í¬í•¨)
    await saveToServer();
  }

  // 5. ì‚­ì œ
  async function deleteMemo(id) {
    if (!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
    memoData = memoData.filter(m => m.id !== id);
    renderList();
    await saveToServer();
  }

  // ì—”í„°í‚¤ ì…ë ¥ ì§€ì›
  function handleEnter(e) {
    if(e.key === 'Enter') addMemo();
  }

  // 6. ë Œë”ë§ (ê³ ì •ëœ ë©”ëª¨ ìƒë‹¨ ë°°ì¹˜)
  function renderList() {
    const listEl = document.getElementById('memoList');
    listEl.innerHTML = '';

    // ì •ë ¬ ë¡œì§: ê³ ì •ëœ(isPinned=true) ê²ƒì´ ë¬´ì¡°ê±´ ìœ„ë¡œ
    const sortedData = [...memoData].sort((a, b) => {
      if (a.isPinned === b.isPinned) return 0; // ë‘˜ ë‹¤ ê°™ìœ¼ë©´ ìˆœì„œ ìœ ì§€ (ìµœì‹ ìˆœ)
      return a.isPinned ? -1 : 1; // aê°€ í•€ì´ë©´ ì•ìœ¼ë¡œ(-1)
    });

    if (sortedData.length === 0) {
      listEl.innerHTML = '<li style="text-align:center; color:#ccc; padding:20px;">No memos yet â˜ï¸</li>';
      return;
    }

    sortedData.forEach(item => {
      const li = document.createElement('li');
      li.className = `memo-item ${item.isPinned ? 'pinned' : ''}`;
      
      li.innerHTML = `
        <div class="meta-row">
          <span>${item.date} ${item.time}</span>
          <div class="actions">
            <button class="icon-btn btn-pin" onclick="togglePin(${item.id})" title="ê³ ì •í•˜ê¸°">ğŸ“Œ</button>
            <button class="icon-btn btn-del" onclick="deleteMemo(${item.id})" title="ì‚­ì œ">âœ–</button>
          </div>
        </div>
        <div class="content-row">${item.text}</div>
      `;
      listEl.appendChild(li);
    });
  }

  // ì‹œì‘ ì‹œì—ëŠ” ë‹«í˜€ìˆëŠ” ìƒíƒœ. 
  // ì›í•˜ë©´ loadMemos()ë¥¼ ì—¬ê¸°ì„œ í˜¸ì¶œí•´ì„œ ë¯¸ë¦¬ ë¡œë”©í•´ë‘˜ ìˆ˜ë„ ìˆìŒ.
</script>
</body>
</html>